<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Game Catur Web dengan Bidak Mentahan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; text-align: center; margin: 0; padding: 15px; }
    h2 { margin-bottom: 12px; }
    #welcome { margin-bottom: 15px; }
    img.ornamen { width: 190px; margin: 6px; border: 1px solid #bbb; border-radius: 5px; }
    #nameInput, #menu, #game, #result { margin-top: 15px; }
    #board { margin: 12px auto; }
    button, input { font-size: 16px; padding: 8px 14px; border-radius: 5px; border: 1px solid #888; }
    button { cursor: pointer; background-color: #eaeaea; }
    button:hover { background-color: #cfcfcf; }
    input { width: 200px; }
    .hidden { display: none; }
    #status { margin-top: 12px; font-weight: bold; }
    #footer { margin-top: 40px; font-size: 12px; color: #777; }
  </style>
</head>
<body>
  <h2>Game Catur Online</h2>

  <div id="welcome">
    <img src="quality_restoration_20251008112907799.jpg" alt="Papan Catur" class="ornamen" />
    <img src="quality_restoration_20251008113117094.jpg" alt="Bidak Catur" class="ornamen" />
    <p>Selamat datang! Masukkan nama lalu pilih mode main: lawan Bot atau P1 vs P2.</p>
  </div>

  <div id="nameInput">
    <input type="text" id="playerName" placeholder="Masukkan Nama Anda" />
    <button id="startBtn">Mulai</button>
  </div>

  <div id="menu" class="hidden">
    <button id="vsBot">Lawan Bot</button>
    <button id="vsP2">P1 vs P2</button>
  </div>

  <div id="game" class="hidden">
    <div id="board" style="width: 320px;"></div>
    <div id="status"></div>
    <button id="restartBtn">Restart</button>
  </div>

  <div id="result" class="hidden">
    <p id="resultText"></p>
  </div>

  <div id="footer">
    &copy; 2025 Game Catur Web | Powered by chessboard.js & chess.js
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.0/chess.min.js"></script>
  <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
  <script>
    const webhookURL = ""; // Ganti dengan webhook Discord anda jika ingin pakai, kosongkan jika tidak
    let game = new Chess();
    let board = null;
    let playerName = "";
    let gameMode = "";
    let startTime = null;

    $("#startBtn").click(() => {
      playerName = $("#playerName").val().trim();
      if (!playerName) {
        alert("Masukkan nama Anda dulu!");
        return;
      }
      $("#nameInput").hide();
      $("#menu").show();
    });

    $("#vsBot").click(() => startGame("bot"));
    $("#vsP2").click(() => startGame("pvp"));
    $("#restartBtn").click(() => {
      $("#game").hide();
      $("#result").hide();
      $("#menu").show();
      game.reset();
      board.position("start");
    });

    function startGame(mode) {
      gameMode = mode;
      game.reset();
      startTime = new Date();
      $("#menu").hide();
      $("#result").hide();
      $("#game").show();

      if (board) board.destroy();
      board = Chessboard("board", {
        draggable: true,
        position: "start",
        onDrop: onDrop,
      });
      updateStatus();
    }

    function onDrop(source, target) {
      let move = game.move({ from: source, to: target, promotion: "q" });
      if (move === null) return "snapback";
      updateStatus();

      if (gameMode === "bot" && !game.game_over()) {
        setTimeout(botMove, 400);
      }
      if (game.game_over()) {
        endGame();
      }
    }

    function botMove() {
      let moves = game.moves();
      if (moves.length === 0) return;
      let move = moves[Math.floor(Math.random() * moves.length)];
      game.move(move);
      board.position(game.fen());
      updateStatus();
      if (game.game_over()) {
        endGame();
      }
    }

    function updateStatus() {
      let status = "";
      if (game.in_checkmate()) {
        status = "Checkmate! " + (game.turn() === "w" ? "Hitam" : "Putih") + " menang!";
      } else if (game.in_draw()) {
        status = "Seri.";
      } else {
        status = (game.turn() === "w" ? "Putih" : "Hitam") + " giliran jalan";
      }
      $("#status").text(status);
    }

    function endGame() {
      const endTime = new Date();
      const duration = ((endTime - startTime) / 1000).toFixed(2);
      let message = "";

      if (game.in_checkmate()) {
        const winner = game.turn() === "w" ? "Hitam" : "Putih";
        message = `Game selesai, pemenang: ${winner}. Nama: ${playerName}, waktu bermain: ${duration} detik.`;
        if (gameMode === "bot" && winner === "Putih" && webhookURL) {
          fetch(webhookURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              content: `${playerName} mengalahkan bot dalam waktu ${duration} detik!`,
            }),
          });
        }
      } else {
        message = `Game selesai dengan hasil seri. Nama: ${playerName}, waktu bermain: ${duration} detik.`;
      }

      $("#resultText").text(message);
      $("#result").show();
    }
  </script>
</body>
</html>    button:hover {
      background: #e0e0e0;
      transform: scale(1.05);
    }

    #musicBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
      transition: transform 0.3s ease;
    }

    #musicBtn:hover {
      background: rgba(255, 255, 255, 1);
      transform: rotate(20deg) scale(1.1);
    }

    .piece {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body>
  <button id="musicBtn">üéµ</button>

  <div class="container">
    <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
    <div id="board"></div>
    <button id="resetBtn">Mulai Ulang</button>
  </div>

  <audio id="bgMusic" autoplay loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
    let playerName = prompt("Masukkan nama kamu:") || "Pemain";

    const game = new Chess();
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop,
      pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    // PERBAIKAN PENTING: Menggunakan CDN untuk Stockfish agar file bot terload
    const stockfish = new Worker("https://cdn.jsdelivr.net/npm/stockfish@16.1/src/stockfish.js"); 

    // Inisialisasi Stockfish
    stockfish.postMessage('uci');

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      updateBoard();
      if (!game.game_over()) setTimeout(makeEngineMove, 500);
      else gameOver();
    }

    function updateBoard() {
      board.position(game.fen(), true);
    }

    function makeEngineMove() {
      const boardEl = document.querySelector('#board');
      // Efek cahaya saat bot berpikir
      boardEl.style.boxShadow =
        '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';

      // Set posisi dan minta bot mencari langkah terbaik
      stockfish.postMessage('position fen ' + game.fen());
      stockfish.postMessage('go depth 10');

      stockfish.onmessage = function (e) {
        const line = e.data;
        if (line.startsWith('bestmove')) {
          const mv = line.split(' ')[1];
          if (mv) {
            game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
            updateBoard();
            // Kembalikan efek cahaya normal
            boardEl.style.boxShadow =
              '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
            if (game.game_over()) gameOver();
          }
          // Hentikan pesan dari bot setelah langkah terbaik ditemukan
          stockfish.onmessage = null; 
        }
      };
    }

    function gameOver() {
      let result;
      if (game.in_checkmate()) {
        result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
      } else {
        result = 'Seri ü§ù';
      }
      alert(`Permainan selesai!\nHasil: ${result}`);
      sendToDiscord(result);
    }

    function sendToDiscord(result) {
      const msg = {
        content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
      };
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(msg)
      }).catch(e => console.error("Gagal mengirim ke Discord:", e));
    }

    // üéµ Musik
    const bgMusic = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let isPlaying = true;

    // Memutar musik setelah interaksi pertama pengguna (aturan browser)
    document.body.addEventListener("click", () => {
      if (bgMusic.paused) bgMusic.play();
    }, { once: true });

    musicBtn.onclick = () => {
      if (isPlaying) {
        bgMusic.pause();
        musicBtn.textContent = "üîá";
      } else {
        // Coba putar lagi
        bgMusic.play().catch(e => console.log("Gagal memutar musik:", e)); 
        musicBtn.textContent = "üéµ";
      }
      isPlaying = !isPlaying;
    };

    // üîÅ Reset Game
    document.getElementById("resetBtn").onclick = () => {
      game.reset();
      board.start();
    };
  </script>
</body>
</html>
      transition: all 0.3s ease;
    }

    h1 {
      margin-top: 10px;
      color: #ffffff;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
    }

    #board {
      width: 340px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow:
        -8px 0 25px rgba(255, 255, 255, 0.2),
         8px 0 25px rgba(255, 255, 255, 0.2);
      transition: all 0.5s ease;
    }

    button {
      background: #ffffff;
      border: none;
      padding: 10px 25px;
      margin: 10px;
      color: #000;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      transition: 0.3s ease;
    }

    button:hover {
      background: #e0e0e0;
      transform: scale(1.05);
    }

    #musicBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
      transition: transform 0.3s ease;
    }

    #musicBtn:hover {
      background: rgba(255, 255, 255, 1);
      transform: rotate(20deg) scale(1.1);
    }

    .piece {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body>
  <button id="musicBtn">üéµ</button>

  <div class="container">
    <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
    <div id="board"></div>
    <button id="resetBtn">Mulai Ulang</button>
  </div>

  <audio id="bgMusic" autoplay loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
    let playerName = prompt("Masukkan nama kamu:") || "Pemain";

    const game = new Chess();
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop,
      pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    const stockfish = new Worker("stockfish.wasm.js");

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      updateBoard();
      if (!game.game_over()) setTimeout(makeEngineMove, 500);
      else gameOver();
    }

    function updateBoard() {
      board.position(game.fen(), true);
    }

    function makeEngineMove() {
      const boardEl = document.querySelector('#board');
      boardEl.style.boxShadow =
        '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';

      stockfish.postMessage('position fen ' + game.fen());
      stockfish.postMessage('go depth 10');

      stockfish.onmessage = function (e) {
        const line = e.data;
        if (line.startsWith('bestmove')) {
          const mv = line.split(' ')[1];
          if (mv) {
            game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
            updateBoard();
            boardEl.style.boxShadow =
              '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
            if (game.game_over()) gameOver();
          }
        }
      };
    }

    function gameOver() {
      let result;
      if (game.in_checkmate()) {
        result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
      } else {
        result = 'Seri ü§ù';
      }
      alert(`Permainan selesai!\nHasil: ${result}`);
      sendToDiscord(result);
    }

    function sendToDiscord(result) {
      const msg = {
        content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
      };
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(msg)
      });
    }

    // üéµ Musik
    const bgMusic = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let isPlaying = true;

    document.body.addEventListener("click", () => {
      if (bgMusic.paused) bgMusic.play();
    }, { once: true });

    musicBtn.onclick = () => {
      if (isPlaying) {
        bgMusic.pause();
        musicBtn.textContent = "üîá";
      } else {
        bgMusic.play();
        musicBtn.textContent = "üéµ";
      }
      isPlaying = !isPlaying;
    };

    // üîÅ Reset Game
    document.getElementById("resetBtn").onclick = () => {
      game.reset();
      board.start();
    };
  </script>
</body>
</html>    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    transition: 0.3s ease;
  }

  button:hover {
    background: #e0e0e0;
    transform: scale(1.05);
  }

  #musicBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.7);
    padding: 10px;
    border-radius: 50%;
    font-size: 20px;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
    transition: transform 0.3s ease;
  }

  #musicBtn:hover {
    background: rgba(255, 255, 255, 1);
    transform: rotate(20deg) scale(1.1);
  }

  .piece {
    transition: all 0.3s ease-in-out;
  }
</style>

<!-- CHESS LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/js/chessboard-1.0.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/css/chessboard-1.0.0.min.css">
</head>

<body>

<!-- Tombol musik -->
<button id="musicBtn">üéµ</button>

<div class="container">
  <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
  <div id="board"></div>
  <button id="resetBtn">Mulai Ulang</button>
</div>

<!-- Musik -->
<audio id="bgMusic" autoplay loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
let playerName = prompt("Masukkan nama kamu:") || "Pemain";

let game = new Chess();
let board = Chessboard('board', {
  draggable: true,
  position: 'start',
  onDrop: onDrop,
  pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
  moveSpeed: 'slow'
});

const stockfish = new Worker("https://cdn.jsdelivr.net/npm/stockfish/src/stockfish-nnue.wasm.js");

function onDrop(source, target) {
  const move = game.move({ from: source, to: target, promotion: 'q' });
  if (move === null) return 'snapback';
  updateBoard();
  if (!game.game_over()) setTimeout(makeEngineMove, 500);
  else gameOver();
}

function updateBoard() {
  board.position(game.fen(), true);
}

function makeEngineMove() {
  const boardElement = document.querySelector('#board');
  boardElement.style.boxShadow = 
    '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';
  
  stockfish.postMessage('position fen ' + game.fen());
  stockfish.postMessage('go depth 10');
  
  stockfish.onmessage = function(e) {
    const line = e.data;
    if (line.startsWith('bestmove')) {
      const mv = line.split(' ')[1];
      if (mv) {
        game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
        updateBoard();
        // Kembalikan efek cahaya normal
        boardElement.style.boxShadow = 
          '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
        if (game.game_over()) gameOver();
      }
    }
  };
}

function gameOver() {
  let result;
  if (game.in_checkmate()) {
    result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
  } else {
    result = 'Seri ü§ù';
  }
  alert(`Permainan selesai!\nHasil: ${result}`);
  sendToDiscord(result);
}

function sendToDiscord(result) {
  const msg = {
    content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
  };
  fetch(webhookURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(msg)
  });
}

// Musik
const bgMusic = document.getElementById("bgMusic");
const musicBtn = document.getElementById("musicBtn");
let isPlaying = true;

document.body.addEventListener("click", () => {
  if (bgMusic.paused) bgMusic.play();
}, { once: true });

musicBtn.onclick = () => {
  if (isPlaying) {
    bgMusic.pause();
    musicBtn.textContent = "üîá";
  } else {
    bgMusic.play();
    musicBtn.textContent = "üéµ";
  }
  isPlaying = !isPlaying;
};

// Reset
document.getElementById("resetBtn").onclick = () => {
  game.reset();
  board.start();
};
</script>

</body>
</html>        }
      }
    };

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      board.position(game.fen());
      stockfish.postMessage("position fen " + game.fen());
      stockfish.postMessage("go depth 15");
    }
  </script>
</body>
</html>
