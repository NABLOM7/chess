<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ôüÔ∏è Catur vs Bot + Musik</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/css/chessboard-1.0.0.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/js/chessboard-1.0.0.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(145deg, #1a1a1a, #2a2a2a, #3a3a3a);
      color: #f5f5f5;
      margin: 0;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      backdrop-filter: blur(15px);
    }

    .container {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 25px;
      box-shadow: 0 8px 30px rgba(255, 255, 255, 0.15);
      padding: 25px;
      margin-top: 40px;
      width: 90%;
      max-width: 400px;
      backdrop-filter: blur(25px);
      transition: all 0.3s ease;
    }

    h1 {
      margin-top: 10px;
      color: #ffffff;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
    }

    #board {
      width: 340px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow:
        -8px 0 25px rgba(255, 255, 255, 0.2),
         8px 0 25px rgba(255, 255, 255, 0.2);
      transition: all 0.5s ease;
    }

    button {
      background: #ffffff;
      border: none;
      padding: 10px 25px;
      margin: 10px;
      color: #000;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      transition: 0.3s ease;
    }

    button:hover {
      background: #e0e0e0;
      transform: scale(1.05);
    }

    #musicBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
      transition: transform 0.3s ease;
    }

    #musicBtn:hover {
      background: rgba(255, 255, 255, 1);
      transform: rotate(20deg) scale(1.1);
    }

    .piece {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body>
  <button id="musicBtn">üéµ</button>

  <div class="container">
    <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
    <div id="board"></div>
    <button id="resetBtn">Mulai Ulang</button>
  </div>

  <audio id="bgMusic" autoplay loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
    let playerName = prompt("Masukkan nama kamu:") || "Pemain";

    const game = new Chess();
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop,
      pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    // PERBAIKAN PENTING: Menggunakan CDN untuk Stockfish agar file bot terload
    const stockfish = new Worker("https://cdn.jsdelivr.net/npm/stockfish@16.1/src/stockfish.js"); 

    // Inisialisasi Stockfish
    stockfish.postMessage('uci');

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      updateBoard();
      if (!game.game_over()) setTimeout(makeEngineMove, 500);
      else gameOver();
    }

    function updateBoard() {
      board.position(game.fen(), true);
    }

    function makeEngineMove() {
      const boardEl = document.querySelector('#board');
      // Efek cahaya saat bot berpikir
      boardEl.style.boxShadow =
        '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';

      // Set posisi dan minta bot mencari langkah terbaik
      stockfish.postMessage('position fen ' + game.fen());
      stockfish.postMessage('go depth 10');

      stockfish.onmessage = function (e) {
        const line = e.data;
        if (line.startsWith('bestmove')) {
          const mv = line.split(' ')[1];
          if (mv) {
            game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
            updateBoard();
            // Kembalikan efek cahaya normal
            boardEl.style.boxShadow =
              '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
            if (game.game_over()) gameOver();
          }
          // Hentikan pesan dari bot setelah langkah terbaik ditemukan
          stockfish.onmessage = null; 
        }
      };
    }

    function gameOver() {
      let result;
      if (game.in_checkmate()) {
        result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
      } else {
        result = 'Seri ü§ù';
      }
      alert(`Permainan selesai!\nHasil: ${result}`);
      sendToDiscord(result);
    }

    function sendToDiscord(result) {
      const msg = {
        content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
      };
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(msg)
      }).catch(e => console.error("Gagal mengirim ke Discord:", e));
    }

    // üéµ Musik
    const bgMusic = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let isPlaying = true;

    // Memutar musik setelah interaksi pertama pengguna (aturan browser)
    document.body.addEventListener("click", () => {
      if (bgMusic.paused) bgMusic.play();
    }, { once: true });

    musicBtn.onclick = () => {
      if (isPlaying) {
        bgMusic.pause();
        musicBtn.textContent = "üîá";
      } else {
        // Coba putar lagi
        bgMusic.play().catch(e => console.log("Gagal memutar musik:", e)); 
        musicBtn.textContent = "üéµ";
      }
      isPlaying = !isPlaying;
    };

    // üîÅ Reset Game
    document.getElementById("resetBtn").onclick = () => {
      game.reset();
      board.start();
    };
  </script>
</body>
</html>
      transition: all 0.3s ease;
    }

    h1 {
      margin-top: 10px;
      color: #ffffff;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
    }

    #board {
      width: 340px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow:
        -8px 0 25px rgba(255, 255, 255, 0.2),
         8px 0 25px rgba(255, 255, 255, 0.2);
      transition: all 0.5s ease;
    }

    button {
      background: #ffffff;
      border: none;
      padding: 10px 25px;
      margin: 10px;
      color: #000;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      transition: 0.3s ease;
    }

    button:hover {
      background: #e0e0e0;
      transform: scale(1.05);
    }

    #musicBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
      transition: transform 0.3s ease;
    }

    #musicBtn:hover {
      background: rgba(255, 255, 255, 1);
      transform: rotate(20deg) scale(1.1);
    }

    .piece {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>

<body>
  <button id="musicBtn">üéµ</button>

  <div class="container">
    <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
    <div id="board"></div>
    <button id="resetBtn">Mulai Ulang</button>
  </div>

  <audio id="bgMusic" autoplay loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
    let playerName = prompt("Masukkan nama kamu:") || "Pemain";

    const game = new Chess();
    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop,
      pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });

    const stockfish = new Worker("stockfish.wasm.js");

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      updateBoard();
      if (!game.game_over()) setTimeout(makeEngineMove, 500);
      else gameOver();
    }

    function updateBoard() {
      board.position(game.fen(), true);
    }

    function makeEngineMove() {
      const boardEl = document.querySelector('#board');
      boardEl.style.boxShadow =
        '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';

      stockfish.postMessage('position fen ' + game.fen());
      stockfish.postMessage('go depth 10');

      stockfish.onmessage = function (e) {
        const line = e.data;
        if (line.startsWith('bestmove')) {
          const mv = line.split(' ')[1];
          if (mv) {
            game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
            updateBoard();
            boardEl.style.boxShadow =
              '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
            if (game.game_over()) gameOver();
          }
        }
      };
    }

    function gameOver() {
      let result;
      if (game.in_checkmate()) {
        result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
      } else {
        result = 'Seri ü§ù';
      }
      alert(`Permainan selesai!\nHasil: ${result}`);
      sendToDiscord(result);
    }

    function sendToDiscord(result) {
      const msg = {
        content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
      };
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(msg)
      });
    }

    // üéµ Musik
    const bgMusic = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let isPlaying = true;

    document.body.addEventListener("click", () => {
      if (bgMusic.paused) bgMusic.play();
    }, { once: true });

    musicBtn.onclick = () => {
      if (isPlaying) {
        bgMusic.pause();
        musicBtn.textContent = "üîá";
      } else {
        bgMusic.play();
        musicBtn.textContent = "üéµ";
      }
      isPlaying = !isPlaying;
    };

    // üîÅ Reset Game
    document.getElementById("resetBtn").onclick = () => {
      game.reset();
      board.start();
    };
  </script>
</body>
</html>    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    transition: 0.3s ease;
  }

  button:hover {
    background: #e0e0e0;
    transform: scale(1.05);
  }

  #musicBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.7);
    padding: 10px;
    border-radius: 50%;
    font-size: 20px;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
    transition: transform 0.3s ease;
  }

  #musicBtn:hover {
    background: rgba(255, 255, 255, 1);
    transform: rotate(20deg) scale(1.1);
  }

  .piece {
    transition: all 0.3s ease-in-out;
  }
</style>

<!-- CHESS LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/js/chessboard-1.0.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/www/css/chessboard-1.0.0.min.css">
</head>

<body>

<!-- Tombol musik -->
<button id="musicBtn">üéµ</button>

<div class="container">
  <h1>‚ôüÔ∏è Catur vs Stockfish</h1>
  <div id="board"></div>
  <button id="resetBtn">Mulai Ulang</button>
</div>

<!-- Musik -->
<audio id="bgMusic" autoplay loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
const webhookURL = "https://canary.discord.com/api/webhooks/1425071682007072949/J4IWih3OzQrW4vUTe80TvDPC7HRZhItpf3cZ12FLlBMFhVZfh0E3Q7ueJqNf9IsTHZe7";
let playerName = prompt("Masukkan nama kamu:") || "Pemain";

let game = new Chess();
let board = Chessboard('board', {
  draggable: true,
  position: 'start',
  onDrop: onDrop,
  pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
  moveSpeed: 'slow'
});

const stockfish = new Worker("https://cdn.jsdelivr.net/npm/stockfish/src/stockfish-nnue.wasm.js");

function onDrop(source, target) {
  const move = game.move({ from: source, to: target, promotion: 'q' });
  if (move === null) return 'snapback';
  updateBoard();
  if (!game.game_over()) setTimeout(makeEngineMove, 500);
  else gameOver();
}

function updateBoard() {
  board.position(game.fen(), true);
}

function makeEngineMove() {
  const boardElement = document.querySelector('#board');
  boardElement.style.boxShadow = 
    '-8px 0 25px rgba(255,255,255,0.4), 8px 0 25px rgba(255,255,255,0.4)';
  
  stockfish.postMessage('position fen ' + game.fen());
  stockfish.postMessage('go depth 10');
  
  stockfish.onmessage = function(e) {
    const line = e.data;
    if (line.startsWith('bestmove')) {
      const mv = line.split(' ')[1];
      if (mv) {
        game.move({ from: mv.substring(0, 2), to: mv.substring(2, 4), promotion: 'q' });
        updateBoard();
        // Kembalikan efek cahaya normal
        boardElement.style.boxShadow = 
          '-8px 0 25px rgba(255,255,255,0.2), 8px 0 25px rgba(255,255,255,0.2)';
        if (game.game_over()) gameOver();
      }
    }
  };
}

function gameOver() {
  let result;
  if (game.in_checkmate()) {
    result = (game.turn() === 'w') ? 'Kalah üò≠' : 'Menang üéâ';
  } else {
    result = 'Seri ü§ù';
  }
  alert(`Permainan selesai!\nHasil: ${result}`);
  sendToDiscord(result);
}

function sendToDiscord(result) {
  const msg = {
    content: `üéÆ **${playerName}** baru saja main catur dan hasilnya: **${result}**`
  };
  fetch(webhookURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(msg)
  });
}

// Musik
const bgMusic = document.getElementById("bgMusic");
const musicBtn = document.getElementById("musicBtn");
let isPlaying = true;

document.body.addEventListener("click", () => {
  if (bgMusic.paused) bgMusic.play();
}, { once: true });

musicBtn.onclick = () => {
  if (isPlaying) {
    bgMusic.pause();
    musicBtn.textContent = "üîá";
  } else {
    bgMusic.play();
    musicBtn.textContent = "üéµ";
  }
  isPlaying = !isPlaying;
};

// Reset
document.getElementById("resetBtn").onclick = () => {
  game.reset();
  board.start();
};
</script>

</body>
</html>        }
      }
    };

    function onDrop(source, target) {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      board.position(game.fen());
      stockfish.postMessage("position fen " + game.fen());
      stockfish.postMessage("go depth 15");
    }
  </script>
</body>
</html>
